<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | HGS</title>

<style>
/* ---------------- GLOBAL ---------------- */
* { box-sizing: border-box; }

body {
    font-family: "Segoe UI", Arial, sans-serif;
    margin: 0;
    background: linear-gradient(135deg, #f4f7f6, #eef2f3);
    color: #333;
    display: flex;
    min-height: 100vh;
    animation: fadeIn 0.8s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.primary-green { background-color: #2ecc71; }
.text-primary-green { color: #2ecc71; }

/* ---------------- SIDEBAR ---------------- */
.sidebar {
    width: 250px;
    background: linear-gradient(180deg, #2c3e50, #1f2a36);
    color: white;
    padding-top: 20px;
    position: fixed;
    height: 100%;
    box-shadow: 4px 0 12px rgba(0,0,0,0.15);
    transition: all 0.3s ease;
}

.sidebar h2 {
    text-align: center;
    margin-bottom: 35px;
    font-size: 26px;
    color: #2ecc71;
    letter-spacing: 1px;
}

.sidebar a {
    display: flex;
    align-items: center;
    padding: 15px 25px;
    color: white;
    text-decoration: none;
    transition: all 0.25s ease;
    font-size: 16px;
    border-left: 4px solid transparent;
}

.sidebar a svg {
    width: 20px;
    height: 20px;
    margin-right: 10px;
}

.sidebar a:hover,
.sidebar a.active {
    background-color: rgba(255,255,255,0.08);
    color: #2ecc71;
    border-left: 4px solid #2ecc71;
    transform: translateX(4px);
}

/* ---------------- MAIN CONTENT ---------------- */
.main-content {
    margin-left: 250px;
    flex-grow: 1;
    padding: 25px;
}

/* ---------------- HEADER ---------------- */
.header {
    background: white;
    padding: 18px 25px;
    border-radius: 10px;
    box-shadow: 0 6px 14px rgba(0,0,0,0.08);
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
}

/* Toolbar */
.toolbar {
    display:flex;
    gap:12px;
    align-items:center;
    margin-bottom:16px;
}
.toolbar .search {
    flex:1;
    display:flex;
    gap:8px;
}
.toolbar input, .toolbar select { padding:8px 10px; border-radius:8px; border:1px solid #ddd; }
.toolbar button { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; background:#2ecc71; color:white; }
.toolbar button.secondary { background:transparent; border:1px solid #ccc; color:#333; }

/* Make table area a bit denser and interactive */
.grievance-section { padding: 18px; }
.grievance-table th, .grievance-table td { padding: 12px 12px; }
.grievance-table tbody tr:hover { background: linear-gradient(90deg, rgba(46,204,113,0.04), rgba(46,204,113,0.02)); }
.status-badge { display:inline-block; padding:6px 10px; border-radius:999px; font-weight:600; font-size:12px; }
.muted { color:#777; font-size:13px; }

.actions { display:flex; gap:8px; align-items:center; }
.small-btn { padding:6px 10px; border-radius:8px; border:none; cursor:pointer; }
.small-btn.primary { background:#2ecc71; color:white; }
.small-btn.warn { background:#f39c12; color:white; }
.small-btn.gray { background:#eef0f2; color:#333; border:1px solid #ddd; }

.header h1 {
    margin: 0;
    font-size: 26px;
    font-weight: 600;
}

.user-info a {
    margin-left: 15px;
    padding: 8px 14px;
    border-radius: 6px;
    border: 1px solid #ddd;
    text-decoration: none;
    color: #555;
    transition: all 0.2s ease;
}

.user-info a:hover {
    background: #2ecc71;
    color: white;
    border-color: #2ecc71;
}

/* Logout button shared style */
.logout-btn { display:inline-block; padding:8px 12px; border-radius:6px; color:#555; text-decoration:none; border:1px solid #ddd; background:transparent; }
.logout-btn:hover{ background:#2ecc71; color:#fff; border-color:#2ecc71; }

/* Responsive adjustments */
/* ================= ADMIN DASHBOARD RESPONSIVE ================= */

/* Large tablets & small laptops */
@media (max-width: 1100px) {
    .sidebar { width: 210px; }
    .main-content { margin-left: 210px; padding: 18px; }
    .header h1 { font-size: 22px; }
    .widget-content p { font-size: 28px; }
}

/* Tablets */
@media (max-width: 900px) {
    .widgets-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
    .toolbar { flex-direction: column; align-items: stretch; gap: 10px; }
    .toolbar .search { width: 100%; }
    .grievance-table th, .grievance-table td { font-size: 13px; padding: 10px; }
}

/* Mobile */
@media (max-width: 700px) {

    body { flex-direction: column; }

    .sidebar {
        position: relative;
        width: 100%;
        height: 100px;
        display: flex;
        flex-direction: row;
        align-items: center;
        padding: 8px 10px;
    }

    .sidebar h2 {
        margin: 0;
        font-size: 16px;
        flex-shrink: 0;
    }

    .sidebar ul {
        display: flex;
        gap: 10px;
        margin-left: auto;
    }

    .sidebar li { list-style: none; }

    .sidebar a {
        padding: 8px 10px;
        font-size: 13px;
    }

    .sidebar a svg { width: 14px; height: 14px; margin-right: 6px; }

    .main-content { margin-left: 0; padding: 12px; }

    .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }

    .widgets-grid { grid-template-columns: 1fr; gap: 14px; }

    .grievance-section { padding: 14px; }

    .table-responsive { overflow-x: auto; }
}

/* ================= STAFF DASHBOARD TABLE RESPONSIVE ================= */

/* Tablets */
@media (max-width: 900px) {
    .grievance-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
    }
}

/* Mobile */
@media (max-width: 700px) {
    .grievance-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
    }
}

/* Small phones */
@media (max-width: 420px) {
    .grievance-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
    }
}


/* Very small phones */
@media (max-width: 420px) {

    .sidebar ul { flex-wrap: wrap; justify-content: center; }

    .sidebar a span { display: none; }

    .header h1 { font-size: 18px; }

    .widget-content p { font-size: 24px; }

    .small-btn, button.update-status { font-size: 12px; padding: 6px 8px; }
}


/* Make tables scroll horizontally on small screens */
.table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; }

/* ---------------- WIDGETS ---------------- */
.widgets-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 22px;
    margin-bottom: 30px;
}

.widget {
    background: white;
    padding: 22px;
    border-radius: 12px;
    box-shadow: 0 8px 18px rgba(0,0,0,0.08);
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.widget:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 26px rgba(0,0,0,0.12);
}

.widget-content h3 {
    margin: 0;
    font-size: 15px;
    color: #777;
}

.widget-content p {
    margin: 6px 0 0;
    font-size: 34px;
    font-weight: bold;
}

.widget-icon {
    width: 54px;
    height: 54px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.widget-icon svg {
    width: 24px;
    height: 24px;
    fill: white;
}

.widget.total .widget-icon { background: #2ecc71; }
.widget.pending .widget-icon { background: #f39c12; }
.widget.resolved .widget-icon { background: #3498db; }
.widget.users .widget-icon { background: #9b59b6; }

/* ---------------- TABLE ---------------- */
.grievance-section {
    background: white;
    padding: 22px;
    border-radius: 12px;
    box-shadow: 0 8px 18px rgba(0,0,0,0.08);
}

.grievance-section h2 {
    margin-top: 0;
    font-size: 22px;
    border-bottom: 2px solid #eee;
    padding-bottom: 10px;
}

.grievance-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}

.grievance-table th,
.grievance-table td {
    padding: 14px 15px;
    border-bottom: 1px solid #eee;
}

.grievance-table th {
    background: #f8f9fa;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.grievance-table tr {
    transition: background 0.2s ease, transform 0.2s ease;
}

.grievance-table tr:hover {
    background: #f4fdf8;
    transform: scale(1.005);
}

/* ---------------- STATUS TAGS ---------------- */
.status-tag {
    padding: 5px 10px;
    border-radius: 14px;
    font-size: 12px;
    font-weight: bold;
    color: white;
}

.status-pending { background: #f39c12; }
.status-resolved { background: #2ecc71; }
.status-in-review { background: #3498db; }
.status-investigating { background: #9b59b6; }
.status-closed { background: #ff0000; }

/* ---------------- FORM CONTROLS ---------------- */
select {
    padding: 6px 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    transition: border-color 0.2s ease;
}

select:focus {
    outline: none;
    border-color: #2ecc71;
}

button.update-status {
    padding: 7px 12px;
    margin-left: 6px;
    border-radius: 6px;
    border: none;
    background: #2ecc71;
    color: white;
    cursor: pointer;
    transition: all 0.25s ease;
}

button.update-status:hover {
    background: #27ae60;
    transform: translateY(-1px);
}
</style>
</head>

<body>

<div class="sidebar">
        <h2>HGS Admin</h2>
        <ul>
            <li>
                <a href="#" class="active">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                    <span>Dashboard</span>
                </a>
            </li>
            <li>
                <a href="#complaints-section">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path></svg>
                    <span>Grievances</span>
                </a>
            </li>
            <!-- <li>
                <a href="#">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0z"></path><path fill-rule="evenodd" d="M18 8a2 2 0 012 2v6a2 2 0 01-2 2H2a2 2 0 01-2-2v-6a2 2 0 012-2h12a2 2 0 002 2zm-5 4a1 1 0 100 2h.01a1 1 0 100-2H13zm-5-3a1 1 0 100 2h.01a1 1 0 100-2H8zm-2 2a1 1 0 100 2h.01a1 1 0 100-2H6z" clip-rule="evenodd"></path></svg>
                    <span>Users</span>
                </a>
            </li> -->
            <!-- <li>
                <a href="#">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"></path></svg>
                    <span>Reports</span>
                </a>
            </li> -->
            <li>
                <a href="#">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.49 3.17c-.38-.21-.88-.21-1.26 0l-2.43 1.34a1 1 0 00-.5.87v3.46c0 .48.37.88.87.88h3.46c.48 0 .88-.37.88-.87V4.4c0-.36-.19-.7-.5-.87l-2.43-1.34z" clip-rule="evenodd"></path><path d="M10 18a8 8 0 100-16 8 8 0 000 16z"></path></svg>
                    <span>Settings</span>
                </a>
            </li>
        </ul>
    </div>

<script src="auth.js"></script>
<script>
        async function loadAdminGrievances(){
            try{
                const res = await authFetch('http://localhost:8080/api/grievances');
                if(!res.ok) throw new Error('Failed');
                const data = await res.json();
                const tbody = document.querySelector('.grievance-section tbody');
                tbody.innerHTML = '';
                data.forEach(g => {
                                        const tr = document.createElement('tr');
                                        const status = (g.status || 'PENDING').toString().toUpperCase();
                                        const displayStatus = status === 'IN_REVIEW' ? 'In Review' : status === 'INVESTIGATING' ? 'Investigating' : status === 'RESOLVED' ? 'Resolved' : status === 'PENDING' ? 'Pending' : status;
                                        tr.innerHTML = `
                                                <td>${g.id}</td>
                                                <td>${g.title || ''}</td>
                                                <td>${g.user ? g.user.name || g.user.email : ''}</td>
                                                <td>${g.user ? g.user.role : ''}</td>
                                                <td>${g.createdAt ? g.createdAt.split('T')[0] : ''}</td>
                                                <td><span class="status-${status.toLowerCase().replace(/_/g,'-')} status-tag">${displayStatus}</span></td>
                                                <td>${g.feedback ? (g.feedback.length>60 ? g.feedback.substring(0,60)+'...' : g.feedback) : '-'}</td>
                                                <td>
                                                    <select data-id="${g.id}" class="status-select">
                                                        <option value="PENDING">Pending</option>
                                                        <option value="IN_REVIEW">In Review</option>
                                                        <option value="INVESTIGATING">Investigating</option>
                                                        <option value="RESOLVED">Resolved</option>
                                                    </select>
                                                    <button class="update-status">Update</button>
                                                </td>
                                        `;
                    tbody.appendChild(tr);
                                        // set the select to current status code
                                        const sel = tr.querySelector('.status-select');
                                        if (sel) sel.value = status;
                });

                document.querySelectorAll('.update-status').forEach(btn=>{
                    btn.addEventListener('click', async (ev)=>{
                        const sel = ev.target.previousElementSibling;
                        const id = sel.getAttribute('data-id');
                        const status = sel.value;
                        try{
                            const r = await authFetch('http://localhost:8080/api/grievances/'+id+'/status?status='+encodeURIComponent(status), { method: 'PUT' });
                            if(!r.ok){ const t = await r.text().catch(()=>null); throw new Error(r.status+' '+t); }
                            alert('Updated');
                            await loadAdminGrievances();
                        }catch(e){ console.error(e); alert('Update failed: '+e.message); }
                    });
                });

            }catch(e){ console.error('loadAdminGrievances', e); }
        }

        document.addEventListener('DOMContentLoaded', loadAdminGrievances);
    </script>

    <div class="main-content">
        
        <div class="header">
            <h1>Analytics Overview</h1>
            <div class="user-info">
                <span>Welcome, Admin User</span>
                <a href="home.html" class="logout-btn" style="margin-left: 15px;">Logout</a>
            </div>
        </div>

        <div class="widgets-grid">
            
            <div class="widget total">
                <div class="widget-content">
                    <h3>Total Grievances</h3>
                    <p><span id="stat-total">0</span></p>
                </div>
                <div class="widget-icon">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path></svg>
                </div>
            </div>

            <div class="widget pending">
                <div class="widget-content">
                    <h3>Pending Grievances</h3>
                    <p><span id="stat-pending">0</span></p>
                </div>
                <div class="widget-icon">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 9.586V6z" clip-rule="evenodd"></path></svg>
                </div>
            </div>

            <div class="widget resolved">
                <div class="widget-content">
                    <h3>Resolved This Month</h3>
                    <p><span id="stat-resolved-month">0</span></p>
                </div>
                <div class="widget-icon">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                </div>
            </div>

            <div class="widget users">
                <div class="widget-content">
                    <h3>Active Users</h3>
                    <p><span id="stat-active-users">0</span></p>
                </div>
                <div class="widget-icon">
                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 00-2-2h-2a2 2 0 00-2 2v1h-2V8a2 2 0 00-2-2H4a2 2 0 00-2 2v1H0v2h1v1a10 10 0 001 3v1a2 2 0 002 2h12a2 2 0 002-2v-1a10 10 0 001-3v-1h1v-2h-2V8z"></path></svg>
                </div>
            </div>

        </div>
        <div class="grievance-section" id="complaints-section">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                <h2 style="margin:0">Recent Grievances</h2>
                <div class="muted">Last updated: <span id="last-updated">--</span></div>
            </div>

            <div class="toolbar">
                <div class="search">
                    <input id="admin-search" type="search" placeholder="Search by subject, id or reporter...">
                    <select id="admin-status-filter">
                        <option value="">All Statuses</option>
                        <option value="PENDING">Pending</option>
                        <option value="IN_REVIEW">In Review</option>
                        <option value="INVESTIGATING">Investigating</option>
                        <option value="RESOLVED">Resolved</option>
                        <option value="CLOSED">Closed</option>
                    </select>
                </div>
                <div class="actions">
                    <button id="refresh-btn" class="small-btn gray">Refresh</button>
                    <!-- <button id="export-btn" class="small-btn secondary">Export CSV</button> -->
                </div>
            </div>

            <table class="grievance-table">
                <thead>
                    <tr>
                        <th style="width:60px">ID</th>
                        <th>Subject</th>
                        <th style="width:180px">Reported By</th>
                        <th style="width:90px">Role</th>
                        <th style="width:120px">Date</th>
                        <th style="width:140px">Status</th>
                        <th style="width:220px">Feedback</th>
                        <th style="width:220px">Action</th>
                    </tr>
                </thead>
                <tbody id="admin-tbody">
                </tbody>
            </table>
        </div>
    </div>

</body>
</html>
<script>
    // keep existing load behavior but render into a buffer so we can filter/search
    let adminData = [];

    async function loadAdminGrievances(){
        try{
            const res = await authFetch('http://localhost:8080/api/grievances');
            if(!res.ok) throw new Error('Failed');
            const data = await res.json();
            adminData = data.map(g => ({
                id: g.id,
                title: g.title || '',
                reporter: g.user ? (g.user.name || g.user.email) : '',
                role: g.user ? g.user.role : '',
                createdAt: g.createdAt ? g.createdAt.split('T')[0] : '',
                status: (g.status || 'PENDING').toString().toUpperCase(),
                feedback: g.feedback || ''
            }));
            // populate dashboard stats from the fetched data
            try {
                const total = adminData.length;
                const pending = adminData.filter(x => (x.status||'').toUpperCase() === 'PENDING').length;
                const now = new Date();
                const curY = now.getFullYear();
                const curM = now.getMonth() + 1; // 1-12
                const resolvedThisMonth = adminData.filter(x => {
                    if ((x.status||'').toUpperCase() !== 'RESOLVED') return false;
                    if (!x.createdAt) return false;
                    const parts = x.createdAt.split('-');
                    if (parts.length < 2) return false;
                    const y = parseInt(parts[0], 10);
                    const m = parseInt(parts[1], 10);
                    return y === curY && m === curM;
                }).length;
                const reporters = new Set(adminData.map(x => (x.reporter||'').toString().trim()).filter(s => s));
                const activeUsers = reporters.size;
                const el = id => document.getElementById(id);
                if (el('stat-total')) el('stat-total').textContent = total;
                if (el('stat-pending')) el('stat-pending').textContent = pending;
                if (el('stat-resolved-month')) el('stat-resolved-month').textContent = resolvedThisMonth;
                if (el('stat-active-users')) el('stat-active-users').textContent = activeUsers;
            } catch (se) { console.warn('Could not populate stats', se); }

            document.getElementById('last-updated').textContent = new Date().toLocaleString();
            renderAdminTable();
        }catch(e){ console.error('loadAdminGrievances', e); }
    }

    function renderAdminTable(){
        const tbody = document.getElementById('admin-tbody');
        const q = (document.getElementById('admin-search').value || '').toLowerCase();
        const statusFilter = document.getElementById('admin-status-filter').value;
        tbody.innerHTML = '';

        const filtered = adminData.filter(g => {
            if (statusFilter && g.status !== statusFilter) return false;
            if (!q) return true;
            return (g.title||'').toLowerCase().includes(q) || (g.reporter||'').toLowerCase().includes(q) || (''+g.id).includes(q);
        });

        filtered.forEach(g => {
            const tr = document.createElement('tr');
            const displayStatus = g.status === 'IN_REVIEW' ? 'In Review' : g.status === 'INVESTIGATING' ? 'Investigating' : g.status === 'RESOLVED' ? 'Resolved' : g.status === 'CLOSED' ? 'Closed' : g.status === 'PENDING' ? 'Pending' : g.status;
            tr.innerHTML = `
                <td>${g.id}</td>
                <td>${g.title}</td>
                <td class="muted">${g.reporter}</td>
                <td>${g.role}</td>
                <td>${g.createdAt}</td>
                <td><span class="status-badge" style="background:${g.status==='PENDING'?'#f39c12':g.status==='RESOLVED'?'#2ecc71':g.status==='CLOSED'?'#27ae60':'#3498db'}">${displayStatus}</span></td>
                <td>${g.feedback? (g.feedback.length>80? g.feedback.substring(0,80)+'...': g.feedback) : '-'}</td>
                <td>
                    <select data-id="${g.id}" class="status-select">
                        <option value="PENDING">Pending</option>
                        <option value="IN_REVIEW">In Review</option>
                        <option value="INVESTIGATING">Investigating</option>
                        <option value="RESOLVED">Resolved</option>
                        <option value="CLOSED">Closed</option>
                    </select>
                    <button class="small-btn primary update-status">Update</button>
                    
                </td>
            `;
            tbody.appendChild(tr);
            const sel = tr.querySelector('.status-select'); if (sel) sel.value = g.status;
        });

        document.querySelectorAll('.update-status').forEach(btn=>{
            btn.addEventListener('click', async (ev)=>{
                const sel = ev.target.previousElementSibling;
                const id = sel.getAttribute('data-id');
                const status = sel.value;
                try{
                    const r = await authFetch('http://localhost:8080/api/grievances/'+id+'/status?status='+encodeURIComponent(status), { method: 'PUT' });
                    if(!r.ok){ const t = await r.text().catch(()=>null); throw new Error(r.status+' '+t); }
                    await loadAdminGrievances();
                }catch(e){ console.error(e); alert('Update failed: '+e.message); }
            });
        });
    }

    function viewDetails(id){ alert('Open details for '+id); }

    document.getElementById('admin-search').addEventListener('input', renderAdminTable);
    document.getElementById('admin-status-filter').addEventListener('change', renderAdminTable);
    document.getElementById('refresh-btn').addEventListener('click', loadAdminGrievances);
    document.getElementById('export-btn').addEventListener('click', ()=>{ alert('Export not implemented (placeholder)'); });

    document.addEventListener('DOMContentLoaded', loadAdminGrievances);
</script>
